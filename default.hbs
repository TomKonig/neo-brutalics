<!DOCTYPE html>
<html lang="{{@site.locale}}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="referrer" content="no-referrer-when-downgrade" />
  <meta name="theme-color" content="#f5f3eb" />
  <meta name="color-scheme" content="light dark" />
  
  <title>{{meta_title}}</title>
  <link rel="canonical" href="{{canonical_url}}" />
  
  {{#if @site.icon}}
  <link rel="icon" type="image/png" href="{{img_url @site.icon size="32x32"}}" sizes="32x32" />
  <link rel="icon" type="image/png" href="{{img_url @site.icon size="16x16"}}" sizes="16x16" />
  {{/if}}
  
  <!-- Local fonts -->
  {{> fonts}}
  
  <!-- Theme CSS (compiled) -->
  <link rel="stylesheet" href="{{asset "css/screen.css"}}"/>
  {{ghost_head}}
</head>
<body class="{{body_class}} {{#if @member}}is-member{{else}}is-guest{{/if}} antialiased">
  <div class="theme-root min-h-screen flex-col">
    {{> nav}}
    <main class="main">{{{body}}}</main>
    {{> footer}}
  </div>

  <!-- Floating theme toggle -->
  <button id="themeToggle" class="theme-toggle btn btn-pill btn-shadow-lg nb-shadow-lg" aria-label="Toggle dark mode" aria-pressed="false"></button>

  <!-- Theme JS -->
  <script defer src="{{asset "js/site.js"}}"></script>
  <script>
  // Add/remove a class while Portal is open so we can draw a big chunky frame behind it
  (function () {
    function toggle(v){ document.documentElement.classList.toggle('nb-portal-open', !!v); }
    // Heuristic: add class on any portal trigger click
    document.addEventListener('click', e => {
      const a = e.target.closest('a[href^="#/portal"]');
      if (a) toggle(true);
    });
    // Watch for Ghost Portal root appearing/disappearing
    const mo = new MutationObserver(() => {
      const root = document.querySelector('#ghost-portal-root');
      // If root disappears, close the frame
      if (!root) toggle(false);
    });
    mo.observe(document.body, {childList: true, subtree: true});
    // Also close on ESC
    window.addEventListener('keydown', e => { if (e.key === 'Escape') toggle(false); });
  })();
</script>
  {{ghost_foot}}
</body>
</html>
